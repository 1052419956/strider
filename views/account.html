{% extends "base.html" %}

{% block bodyContent %}

<div class='span8'>
  <div id="settings"></div>
</div>

<script>
  var user = {{ user | scriptjson | raw }};
</script>
<div class='span12' ng-app="Account" ng-controller="AlertsController">
  <h3>Account Management:</h3>
  <div class="notify-wrapper pull-right">
    <div id="notify" ng-class="{ visible: message.showing }" class="alert alert-[[ message.type ]]">
      <a type="button" class="close" ng-click="clearMessage()">&times;</a>
      <div class="message" ng-bind-html="message.text"></div>
    </div>
  </div>
  <p>
  <div class="tabbable tabs-left" ng-controller="AccountController">
    <ul class='nav nav-tabs'>
      <li class='active'><a href='#email' data-toggle='tab'>Email Address</a></li>
      <li><a href='#password' data-toggle='tab'>Password</a></li>
    </ul>

    <div class='tab-content'>
      <div id="email" class="tab-pane active">
        <div id="account_email" class="span8">
          <div class='email-message'>
            <div class='well'>
              <fieldset>
                <legend>Change Email</legend>
                <div class="control-group email">
                  <label class='control-label'for='email'>Account Email Address</label>
                </div>
                <div class='controls'>
                  <input class="xlarge" type='text' name='email' ng-model="user.email" />
                  <span class="help-inline email"></span>
                </div>
                <div class="actions">
                  <button class="btn" ng-click="changeEmail()">Change Email</button>
                </div>
            </fieldset>
          </div>
        </div>
      </div>
    </div>

      <div id="password" class="tab-pane">
        <div id="change_password" class="span8">
          <form class="password-message" name="passwordForm">
            <div class="well">
              <fieldset>
                <legend>Change Password</legend>
                <div class="control-group password">
                  <label class="control-label" for="password">New Password</label>
                </div>
                <div class="controls">
                  <input class="xlarge" type="password" ng-minlength="8" name="password" ng-model="password">
                  <span class="help-inline password"></span>
                  <span ng-show="passwordForm.password.$dirty && passwordForm.password.$error.minlength">Password must be longer than 8 characters</span>
                </div>
                <div class="control-group password-confirm">
                  <label class="control-label" for="password_confirm">Confirm Password</label>
                </div>
                <div class="controls">
                  <input class="xlarge" type="password" name="confirm_password" ng-model="confirm_password">
                  <span class="help-inline password-confirm"></span>
                  <span ng-show="passwordForm.password.$valid && confirm_password !== password">Passwords must match</span>
                </div>
                <div class="actions">
                  <button class="btn" ng-click="changePassword()" ng-disabled="!passwordForm.$valid || confirm_password !== password">Change Password</a>
                </div>
              </fieldset>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

{% endblock %}

{% block pageScripts %}
<script src="/javascripts/modules/alerts.js"></script>
<script src="/javascripts/pages/account.js" type="text/javascript"></script>
{% endblock %}
